"0","prepare_synergy <- function(df, controls){"
"0","  #not a universal function"
"0","  syn_drug <- df %>%"
"0","    filter(!drug %in% controls & combination == TRUE) %>%"
"0","    #setup the easy stuff"
"0","    mutate(BlockID = paste(""TAS-102"", drug, sep = ""_""),"
"0","           Response = rv*100,"
"0","           Replicate = ifelse(date == ""171128"", 1, 2),"
"0","           DrugRow = ""TAS-102"","
"0","           DrugCol = drug,"
"0","           #build matrix"
"0","           Col = ifelse(drug != ""DMSO"", as.numeric(concentration), 6),"
"0","           Row = ifelse(TAS_concentration != ""0"", as.numeric(TAS_concentration), 6),"
"0","           #define concentrations"
"0","           ConcRow = ifelse(TAS_concentration != ""0"", 25/(5^(as.numeric(TAS_concentration)-1)), 0), #assuming the initila concentration is 50"
"0","           ConcCol = 10/(5^(as.numeric(concentration)-1)),"
"0","           ConcUnit = ""uM"""
"0","           )"
"0","  "
"0","  syn_ctrl <- full_join(syn_drug %>% select(BlockID, line, TAS_concentration, Replicate) %>% distinct(),"
"0","                       #add TAS DMSO controls"
"0","                     df %>%"
"0","              filter(drug == ""DMSO"" & combination == TRUE) %>%"
"0","              mutate(Replicate = ifelse(date == ""171128"", 1, 2)) %>%"
"0","              group_by(line, TAS_concentration, Replicate) %>% "
"0","              mutate(Response = median(rv, na.rm = TRUE)*100) %>%"
"0","              mutate(#define concentrations"
"0","                     ConcRow = ifelse(TAS_concentration != ""0"", 50/(5^(as.numeric(TAS_concentration)-1)), 0), #assuming the initila concentration is 50"
"0","                     ConcCol = 0,"
"0","                     Col = 6,"
"0","                     Row = ifelse(TAS_concentration != ""0"", as.numeric(TAS_concentration), 6),"
"0","                     DrugRow = ""TAS-102"","
"0","                     ConcUnit = ""uM"""
"0","                       )) %>%"
"0","                    #hacky way of formatting the data"
"0","                mutate(DrugCol = substr(BlockID, 9, nchar(BlockID)))"
"0","  "
"0","  syn_mat <- full_join(syn_drug, syn_ctrl) %>% dplyr::select(BlockID, Col, Row, Response, Replicate, DrugRow, DrugCol, ConcRow, ConcCol, ConcUnit, line) %>% distinct()"
"0","  "
"0","  return(syn_mat)"
"0","}"
